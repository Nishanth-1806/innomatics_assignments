<!doctype html>
<html lang="en">
  <head>
    <title>URL Shortener</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>URL Shortener</h1>
      <div>
        <span class="me-2">Logged in as {{ current_user.username }}</span>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary btn-sm">Logout</a>
      </div>
    </div>

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" class="mb-4">
      <div class="mb-3">
        <label class="form-label">Enter URL to shorten</label>
        <input
          name="original_url"
          class="form-control"
          placeholder="https://example.com/very/long/url"
          required
        />
      </div>
      <button type="submit" class="btn btn-primary">Shorten</button>
    </form>

    {% if short_url %}
      <div class="mb-4">
        <label class="form-label">Shortened URL</label>
        <div class="input-group">
          <input
            id="shortUrlInput"
            class="form-control"
            value="{{ short_url }}"
            readonly
          />
          <button class="btn btn-outline-secondary" type="button" onclick="copyShortUrl()">
            Copy
          </button>
        </div>
      </div>
    {% endif %}

    <h2 class="h4 mt-4">Your URL History</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Original URL</th>
          <th>Short URL</th>
        </tr>
      </thead>
      <tbody>
        {% for item in history %}
          <tr>
            <td><a href="{{ item.original_url }}" target="_blank">{{ item.original_url }}</a></td>
            <td>
              <a href="{{ request.host_url.rstrip('/') ~ '/' ~ item.short_code }}" target="_blank">
                {{ request.host_url.rstrip('/') ~ '/' ~ item.short_code }}
              </a>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="2">No URLs shortened yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <script>
      function copyShortUrl() {
        const input = document.getElementById("shortUrlInput");
        input.select();
        input.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(input.value);
        alert("Short URL copied to clipboard!");
      }
    </script>
  </body>
</html>
